import broadlink
from datetime import datetime

# IR codes
ceiling_light = {
    'on' : '260058000001279512131238121411141213121312141139123812141139113912131239113912131238123912381238123912381214113911141213121312141114121312381214110005530001274b12000c720001274b12000d05',
    'fav' : '2600580000012a9215111436141114121411141114111436153614111436153614111436143714111411143615111411141114371411143614361511143614361437141114361412140005510001294914000c700001294914000d05',
    'bright' : '260058000001299314121436141114121312141114111436143714111436143713121436143713121312133714121337143614371312133714371312133714111412131214361411140005510001284b12000c7100012a4914000d05',
    'dark' : '260050000001299314111436141214111411141114121436143614121337143614111437143614111437143614111437143614361412133714111411143615111411141213371411140005510001294914000d050000000000000000',
    'ext_on' : 0
}

tv = {
    '1' : '2600c4004e14131313141313131413141313131427141313131413141300038e4e14131313141313131413141313131427141314131313141300038e4f13131413141313131413131314131328141313131413131300038f4e14131313141314131313141313131427141314131313141300038e4f13131413131314131314131314131328131314131413131300038f4e14121413141313131413131314131427141313131413141300038e4e141314131313141313131413131314281313141313131413000d0500000000',
    '2' : '2600a8004f12281413131215121413141314121428131215131313141300037a4e14271413141214131412141314131427141214121513131300037a4f1328131314131413131314131313142813121513131215130003794f13281314131314131313141313131428131314121413141200037b4e14281313141313131413131413131426151313131413141200037a4f132813131413131314131413131314271413131314131413000d05',
    '3' : '2600a8004e14131328131314131413131314131328131314131413131300037a4e14131427141313131413141313131427141313131413141300037a4e13131428131314131313141314131328131314131313141300037a4e14131328131314131313141314131328131314131413131300037a4f1313142714131314131314131313142714131413131314130003794f131314271413141313131413131314281313141313141313000d05',
    '4' : '2600c4004f1328132814121413141314121413142714121413141214130003664e1427142813131412141314121413142813131412141215130003654f1328132813141312151313131412142813131412151313130003654f1328132814121412151214131412142814121412151214130003664f1328132813131413131314131412142813131412141314130003654f1328132813131412151214131413132813131412151313120003674e142714271413141313131413131314281313141313131413000d0500000000',
    '5' : '2600c4004e14131413132813131413131413131427141313131413141300037a4e13131413142714131313141313141328131314131313141300037a4e14131313142813131413131314131328141313131413131300037a4e14131413132813131413131314131427141313131413141300037a4e14131313142714131314131314131328131314131413131300037a4e14131313142714131413131314131328141313131413131300037b4e131314131427141313131413131314281313141313131413000d0500000000',
    '6' : '2600e0004f1328131314271413141313131413132813141313141313130003664e1427141313281313141314131313142714131413131314130003654e1428131314271413131314131413132813131413141313130003654f1328131314271413141313131413132813131413141313130003664e1427141314271413131314131313142813131413131314130003654e1428131314271413131314131413132813131413131314130003664e1427141313281313141314131313142714131413131314130003654e142714131328141313131413131314271413141313131413000d050000000000000000',
    '7' : '2600c4004f1313142714271413141313131413132814131313141313130003664e1413132813281313141314131313142714131413131314130003654e1413142714271413131314131413132813131413141313130003654f1313142714271413141313131413132813141313141313130003664e1413132814271413131314131313142813131413131314130003654e1413142714271413131314131413132813131413131314130003664e141313281328141313131413131314271413141313131413000d0500000000',
    '8' : '2600c4004e1427142714271413141313131413132814131313141313130003514e1427142813281313141313131413142714131313141313130003524e1427142714271413131314131413132813131413141313130003514e1427142813281313141313141313142714131313141314130003504f1328132814271413131314131314132813131413131314130003514e1427142714281313141313131413142714131313141313130003514f132813281328141313131413131314271413141313131413000d0500000000',
    '9' : '2600c4004e14131313141313281413131314131328131314131413131300037a4f13131413131314271413141313131427141313141313141300037a4e13141313141313281313141314131328131314131313141300037a4e14131313141313281413131314131328131314131413131300037a4f13131413131314281313141313131428131314131313141300037a4e13131413141313281313141314131328131314131313141300037a4f131314131313142714131413131314271413141313131413000d0500000000',
    '10': '2600c4004e1328141313131427141313141313142714131313141313140003654e1427141314131328131314131314132813131413131314130003654f1328131314131427141314121413132814131313141313130003664e1328131413131427141313131413142714131313141314130003654f1328131314131328131413131413132813131413141313130003654f1328131314131427141313131413132814131313141313130003664e142714131413132813131413141313281313141313131413000d0500000000',
    '11': '2600c4004e1413142714131328131314131413132813131413131413130003654f1313142813131427141313131413142714131313141313140003654e1413132814131328131314131313142813131413131314130003654e1413142714131328131314131413132813131413131413130003664e1413132813131428131314131313142813131413131314130003654e1413132814131328131314131313142813131413131314130003664e131314281313142714131413131314271413131314131413000d0500000000',
    '12': '2600a8004f1328132813131428131314131313142714121513131215130003504f1328132814131328131314131314132813131413131314130003514e1428132813131427141314131313142714131314131314130003514d1428142714131328131314131413132714131413131314130003514e1427142714131427141313131413142714131313141313140003504f132813281413132813131413131314281313141313141313000d05',
    'digital' : '260088004f13131427141215131328132813131428132813271413142714121512142900028a4e13131427141314131328132814131328132714281413132813121513132800028b4e14131427141313131427142813121528132813291212152714121513132900028a4e141214281312151214281427141214271428142813131329121413131428000d05',
    'bs' : '2600aa004d15121412152813281312152813131329122913281313132912131412152800028a4e14131313142912291212152813131329132813281312142913131313142800028b4e13131412152813261512142913121429122912291312142912131412142900028a4e14131314132912291212152813131428132813281313142813131312152800028a50121215121528132813131329121314291229122813131427141314121429000d050000000000000000000000000000',
    'cs' : '2600aa004e13291327141313291215122912141327142912281314132813131314132900027351132813281314132714141228141313281328132813151229121314141228000276501229122913141228131314281313142813281327141313281414121413280002764f12281428131313281314132813131427142813281313142714131314132900027550122912291214132912131428131313291328132813131329131313131428000d050000000000000000000000000000',
    'vol_up' : '2600fc004f1213142912131413132912131413142813121413141314130003654e1413132913131313142813131313142912131413131314130003654f1313142813131413132912131413132913131312151313130003664e1313142912131413132912131413142813131313141215130003654f1313142813131313142912131413132912131413141313130003654e1414132912131413132912131413142813131312151313130003664e1413142813131313142912131413132912131413131413130003654f1313142813131314132912131413132912141313141313130003664e141313291313131314281313131413291212151313131413000d05000000000000000000000000',
    'vol_down' : '26008c004e1328142714131313142714131413132813131413131314130003514e1427142714131313142813131413132813131413141313130003514f13281328141313131427141313131428131314131313141300034f501427142714131413132813131413132814131313141313130003514f132813281313141314271413131314271413141313131413000d05000000000000000000000000',
    'vol_mute' : '260018014e1313141314271413132813131413142714131313141313130003664e1413131314271413142714131313142813131413131314130003654f1313141313281314132813131413132814131313141313130003654f1313141314271413132813131413142714131313141313130003664e1413141313281313142813131413132813131413141313130003654f1313141313281314132813131413132814131313141313130003664e1413131413281313142714131413132813131413131314130003654e1413141313281313142813131413132813131413141313130003664e1413131314281313142714131313142813131413131314130003654e141314131328131314271413141313281313141313131413000d05',
    'ch_up' : '26008c004f13131413131314131328141313131427141314131313141300037a4e14131313141313131428131314131328131314131413131300037a4e1413141313131413132813141313142714131313141314130003794f13131413131314131328141313131427141313141313141300037a4e141313131413141313281313141313281413131314131313000d05000000000000000000000000',
    'ch_down' : '26008c004f1328131314131413132813131413132814131313141313130003664e1427141313131413142714131313142714131413131314130003654f1328131314131313142813131413132813131413141313130003654f1328131314131413132813131413142714131313141313130003664e142813131413131314271413141313281313141314131313000d05000000000000000000000000',
    'input_select' : '26008c004e1427141313281413131314271413132814131313141313130003514e1427141314271413131314281313142714131313141314130003514e1427141313281313141314271413132813141313141313130003514f1328131314271413131413281313142714131413131314130003514e142714131328131314131427141313281313141314131313000d05000000000000000000000000',
    'power' : '2600c4004f1329121215281312152813131313142912131413131314130003504f1329121314291213142813121413142912131413131314130003514e14291213142813121429121413131428131214131413141300034f511229121413291213142813131314132912131413131314120003524f1328131313291313132912131413132913131313141313130003514f1329121314291213142813131313142912131413131314130003514f132813131329121314291213141214291214131215131313000d0500000000'
}

audio = {
    'prev' : '2600b0004f141315131413151315261527141315131427141315271427152615131413152714271526151314130001b84e151314131513141315271427141315131427151314271526152714131513142714271526151315120001b84e151314131513141315271427141315131427151314271526152714131513142715261527141315130001b74e15131413151314131527142715131413152615131427152615271413151314271526152714131513000d050000000000000000',
    'next' : '2600b0004f142714131513141315271427151314131526151314271526152714131513142715261527141315130001a44e152714131513141315271427151215131526151314271526152714131513142715261527141315130001a44e152714131513141315261527141315131427151314271526152615131513142714271526151315120001a54e15261513151215131526152714131513142715121527142715261513141315271427152615131413000d050000000000000000',
    'stop' : '2600dc004e151314131513142714271527141315131427141315271427152615131413152714271427151314130001a54e151314131513142715261527141315131427141315271427152615131413152714271526151314130001a54e151314131513142715261527141315131427151314271427152615131413152714271526151314130001a54e151314131513142616261527141315131427141315261527152615131413152714271426161314120001a64e15131413151314271426162615131512152615131526152714261612151315271427142616131413000d05000000000000000000000000',
    'vol_up' : '2600a800501313152714131513142714141413141414131414141315280003684f14131527141315131427151314131513141315131413152700036950131513281314141413271514131315131414141413141428000368501314142813141413142813151313141414141315131413280003695013141428131413151328131414141314141413151314132800036950131413281414131414281314131513141315131413151328000d05',
    'vol_down' : '260070004f1427152615131413152714131513141315131413151314270003574f1427142715131413152714131513141315131413151314270003574e1527142714131513152615131413151314131513141315270003574e152615271413151314271512151315131413151314131526000d050000000000000000',
    'power' : '2600a8004f1427141315271413152714131513141315131413151314270003574e1527141315271413152615131414141314141413151314270003574e1527141315261513142715131413151314131513151314270003574e1526151314271513142715131413151314131513141315260003574f1427151314271414142714131513141315131413151314270003574e152714131527141315261513141315131413151314141427000d05'
}

codes = {
    'light' : ceiling_light,
    'tv' : tv,
    'audio' : audio
}

devices = None

def send_ir_command(cmd_string):
    if (discover()):
        op, val = [ x.strip() for x in cmd_string.split(':') ]
        code = codes[op][val]
        if (code == 0): # extension code
            dispatch(op, val)
        else:
            send(code)
    else:
        print('no devices')

def discover():
    global devices
    if (devices is None):
        devices = broadlink.discover(timeout=5)
        devices[0].auth()
    return (devices is not None)

def dispatch(op, val):
    if (op == 'light'):
        light_ext(val)

def send(code):
    data = bytearray.fromhex(code)
    devices[0].send_data(data)

def light_ext(val):
    if (val == 'ext_on'):
        hour = datetime.now().time().hour
        print (hour)
        if (hour <= 6 or hour >= 18):
            val = 'fav'
        else:
            val = 'on'
        send(codes['light'][val])